<head>
  <style>
    body {
      margin: 0;
    }
  </style>

  <script crossorigin="anonymous" src="https://unpkg.com/three"></script>
  <script crossorigin="anonymous" src="https://unpkg.com/3d-force-graph"></script>
</head>

<body>
  <div id="controls">
    <label>
      Factor A
      <input type="range" id="factor-a" min="0" max="1" step="0.01" value="0.5">
    </label>
    <label>
      Factor B
      <input type="range" id="factor-b" min="0" max="1" step="0.01" value="0.5">
    </label>

  </div>

  <div id="3d-graph"></div>

  <script>
    const imgs = [
      "cat.jpg",
      "dog.jpg",
      "eagle.jpg",
      "elephant.jpg",
      "grasshopper.jpg",
      "octopus.jpg",
      "owl.jpg",
      "panda.jpg",
      "squirrel.jpg",
      "tiger.jpg",
      "whale.jpg",
    ];

    const pairwise = (list) => {
      if (list.length < 2) { return []; }
      const rest = list.slice(1);
      const pairs = rest.map((x) => [list[0], x]);
      return pairs.concat(pairwise(rest));
    }

    const nodes = imgs.map((img, id) => ({ id, img }));

    const links = pairwise([...Array(imgs.length).keys()])
      .map(([source, target]) => ({
        source: source,
        target: target,
        factorA: parseInt(Math.random() * 100, 10),
        factorB: parseInt(Math.random() * 100, 10)
      }));


    const Graph = ForceGraph3D()(document.getElementById("3d-graph"))
      .nodeThreeObject(({ img }) => {
        const imgTexture = new THREE.TextureLoader().load(`./imgs/${img}`);
        const material = new THREE.SpriteMaterial({ map: imgTexture });
        const sprite = new THREE.Sprite(material);
        sprite.scale.set(12, 12);
        return sprite;
      })
      .graphData({ nodes, links })
      .onNodeDragEnd((node) => {
        node.fx = node.x;
        node.fy = node.y;
        node.fz = node.z;
      });

    const reheatSimulation = () => {
      Graph.numDimensions(3); // Re-heat simulation
    }


    const factorARange = document.getElementById("factor-a");
    const factorBRange = document.getElementById("factor-b");
    factorARange.addEventListener("change", reheatSimulation);
    factorBRange.addEventListener("change", reheatSimulation);

    const linkForce = Graph
      .d3Force('link')
      .distance(link => (link.factorA * factorARange.value) + (link.factorB * factorBRange.value));
  </script>
</body>
