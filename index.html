<head>
  <style>
    body {
      margin: 0;
    }
  </style>

  <script crossorigin="anonymous" src="https://unpkg.com/three"></script>
  <script crossorigin="anonymous" src="https://unpkg.com/3d-force-graph"></script>
</head>

<body>
  <div id="controls">
    <label title="peak signal-to-noise ratio">
      PSNR
      <input type="range" id="psnr" min="0" max="1" step="0.1" value="0.5">
    </label>
    <label title="root mean squared error">
      RMSE
      <input type="range" id="rmse" min="0" max="1" step="0.1" value="0.5">
    </label>
    <label title="spectral angle mapper">
      SAM
      <input type="range" id="sam" min="0" max="1" step="0.1" value="0.5">
    </label>

  </div>

  <div id="3d-graph"></div>

  <script>

    const Graph = ForceGraph3D()(document.getElementById("3d-graph"))
      .nodeThreeObject(({ path }) => {
        const imgTexture = new THREE.TextureLoader().load(path);
        const material = new THREE.SpriteMaterial({ map: imgTexture });
        const sprite = new THREE.Sprite(material);
        sprite.scale.set(12, 12);
        return sprite;
      })
      .jsonUrl('graph.json')
      .onNodeDragEnd((node) => {
        node.fx = node.x;
        node.fy = node.y;
        node.fz = node.z;
      });

    const reheatSimulation = () => {
      Graph.numDimensions(3); // Re-heat simulation
    }


    const psnrMultiplier = document.getElementById("psnr");
    const rmseMultiplier = document.getElementById("rmse");
    const samMultiplier = document.getElementById("sam");
    psnrMultiplier.addEventListener("change", reheatSimulation);
    rmseMultiplier.addEventListener("change", reheatSimulation);
    samMultiplier.addEventListener("change", reheatSimulation);

    const norm = (val, max, min) => (val - min) / (max - min);

    const linkForce = Graph
      .d3Force('link')
      .distance(link =>
        (link.metrics.psnr * psnrMultiplier.value) +
        (link.metrics.rmse * rmseMultiplier.value) +
        (link.metrics.sam * samMultiplier.value)
      );
  </script>
</body>
